---
layout: post
title: "로지스틱 회귀분석 (Logistic Regression)"
date: 2020-04-02
use_math: true
author: Oh
---


# Introduction

기계학습의 신경망 모델에서 활성함수로 많이 쓰이는 `sigmoid` 함수가 어떻게 나오게 되었는지 살펴본다.

# 예제 
참고 : [이야기로 설명하는 로지스틱 회귀 분석](https://youtu.be/egeOjGEG1j4)

> 키가 165cm인 사람이 있다. 이 사람이 남자일 확률은?

수식으로는 아래와 같이 조건부 확률로 표현할 수 있다.
$$P(\text{남자} | \text{165cm})$$

단순하게 생각하면 165cm 키인 100명을 모아서 남자의 비율을 구하면 된다.
여기서는 일반적으로 어떤 키를 고정했을 때, 남자일 확률을 구하는 방법을 고려해본다.

# 데이터
출처 : [Size Korea 제7차 인체치수데이터](https://sizekorea.kr/page/data/1_1)

2015년 남자 3191명과 여자 3221명, 총 6412명의 키를 조사한 데이터를 참고했다.
아무리 많은 인원을 조사한다고 해도, 사실 유한명의 도수분포를 얻는다.
하지만, 충분히 많은 인원 수를 조사하였으므로 정규분포를 따른다고 통계적으로 가정할 수 있다.

|            | 남자   | 여자   |
|:----------:|:------:|:------:|
| 평균 $m$   | 172.2  | 158.7  |
| 분산 $s^2$ | 3537.9 | 3292.4 |

키 $x$에 대해서 평균을 $m$이라 두고, 표준편차를 $s$라고 하면 정규분포의 확률밀도함수는 아래와 같다.

$$p(x; m, s) = \frac{1}{\sqrt{2 \pi} s} e^{-\frac{1}{2}(\frac{x-m}{s})^2}$$

남자와 여자의 분포를 그래프로 그려보면 다음과 같다.

|![](https://drive.google.com/uc?id=1L-wtzr8zS2rxUHXv-b0syE5_zqPEpekZ){:width="50%"}|
|:-:|
|남녀 키 분포 (빨강 = 여, 파랑 = 남, 녹색=165cm)|

# 분석

분포의 교점에 해당하는 키에서는 남자일 확률이 0.5가 된다.
여기서 확률에 대해서 *모델*을 정할 필요가 있다.
`sigmoid`를 모델로 사용할 수 있고, 정규분포의 누적분포함수를 모델로 사용할 수있다. 
전자의 방법을 로지스틱 회귀(logistic regression), 후자의 방법을 프로빗 회귀(probit regression)라 한다.
여기서는 로지스틱 회귀 모델로 분석해보자.

키에 해당하는 변수 $x$에 대해서 우리는 남, 여 두 가지 클래스 $c_1$과 $c_2$를 생각한다.
$$P(\text{남자} | \text{165cm}) = P(c_1 | x)$$
베이즈 정리에 의해서,
$$=\frac{P(x|c_1)P(c_1)}{P(x)}$$
분모의 모양을 바꾸면,
$$=\frac{P(x|c_1)P(c_1)}{P(x|c_1)P(c_1) + P(x|c_2)P(c_2)}$$
남자 키의 평균과 표준편차를 $m1, s1$, 여자 키의 평균과 표준편차를 $m2, s2$라 두고 각 클래스의 확률밀도함수를 적용하면,
$$=\frac{p(x;m1,s1)P(c_1)}{p(x;m1,s1)P(c_1) + p(x;m2,s2)P(c_2)}.$$

이 식을 정리하기 전에 다음 질문을 해결해보자.

> 남녀 키의 분산은 비슷하다고 할 수 있을까?

두 분포의 차이를 분석하는 방법에는 여러가지가 있어 아래 순서도를 참고한다.

출처 : [예제와 함께하는 쉬운 통계](http://blog.naver.com/PostView.nhn?blogId=istech7&logNo=50150957927)

|![](https://drive.google.com/uc?id=12UF141kJ8cTVx-HWg_hqi5ZLjN9jD1Oz){:width="80%"}|
|:-:|
|두 집단간 차이 분석 방법|

간단한 등분산 검정에는 $1/2 \leq \frac{s1}{s2} \leq 2$를 쓰기도 한단다.
필요에 따라서 Levene, Bartlett 등의 검정법을 특징에 따라 쓰도록 하자.
여기서는 간단한 등분산 검정으로 **분산이 같다**고 가정한다.

이제 다시 식으로 돌아가서 이어서 식을 바꿔보자.

$$\frac{p(x;m1,s)P(c_1)}{p(x;m1,s)P(c_1) + p(x;m2,s)P(c_2)}$$
$$=\frac{1}{1 + \frac{P(c_2)s}{P(c_1)s} e^{-\frac{1}{2}(\frac{x-m2}{s})^2 + \frac{1}{2}(\frac{x-m2}{s})^2}}$$
$$=\frac{1}{1 + e^{ln P(c_2) - ln P(c_1) - \frac{1}{2}(m2^2-m1^2)s^{-2} - \frac{1}{2}(-m2+m1)s^{-2}x}}$$

식을 잘 보면 $\frac{1}{1 + e^{b+\lambda x}}$ 꼴임을 확인하자.

$P(c_1) = 1-P(c_2)$이므로 $x$가 주어지면 위 값이 최대가 되는 $P(c_2)$를 선택하여 $P(\text{남자} | \text{165cm})$을 계산할 수 있다. 즉, 최대 우도 추정법이다.

# Comments

통계는 엄격한 이론의 흐름보다는 큰 틀 안에 데이터를 두고 가능한 방법을 모색한다는 느낌이 강하다.
아직 공부가 부족해서일까.
위 설명에서 뺀 가설검정에 관한 부분을 좀 더 채워 넣어야 할 듯.
